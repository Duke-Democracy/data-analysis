---
title: "model-building"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#load libraries
library(tidyverse)
library(cpsvote)
library(srvyr)
library(rstanarm)
```

```{r}
#load data
data_20 <- read_csv("data/cps_csv_files/2020 cps.csv")
```

```{r}
#clean 2020 data
data_20 <- data_20 |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = recode(RACE, 
    "100" = "White", 
    "200" = "Black", 
    "300" = "AmIn", 
    "650" = "AAPI", 
    "651" = "AAPI", 
    "652" = "AAPI", 
    "809" = "AAPI", 
    "700" = "OTHER",
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
  SCHLCOLL = recode(SCHLCOLL, 
    "3" = "College", 
    "4" = "College",
    "5" = "Non-College",
    "1" = "HS", 
    "2" = "HS", 
    "0" = "NIU"),
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU"),
  VOTED = recode(VOTED,
                 "1" = "Yes",
                 "2" = "No"), drop.na = TRUE) |> 
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, SCHLCOLL, VOTED, VOSUPPWT)

ids <- c(1,2,4,5,6,8,9,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,44,45,46,47,48,49,50,51,53,54,55,56)
states <- c("Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming")

states_df <- data.frame(ids, states)

names(states_df) <- c('STATEFIP', 'State')

data_20 <- merge(data_20, states_df, by="STATEFIP", all = FALSE) 

#region: recode into 1-4
#region: 11, 12 = Northeast, 21, 22 = Midwest, 31-33 = South, 41, 42 = West
#statefip : recode
#sex: recode 1 = male, 2 = female, 9 = NIU
#race: 100 = White, 200 = Black, 300 = AmIn, 650-652 and 809 = AAPI, 700 = Other, 801-808 = Biracial
#hispan: 000 = Not Hispanic, 100, 102, 103, 104, 108, 109, 200, 300, 400, 500, 600, 710,  611, 612 = Hispanic, 901 and 902 = NIU
#diffany: 1 = No, 2 = Yes, 0 = NIU
#educ: recode
#schlcoll: 3,4, = College, 1,2 = HS, 5 = Non-College, 0 = NIU
#rename them all something descriptive
```

```{r}
```

```{r}
#begin model fitting
fit <- stan_glmer(VOTED ~ .,
                  family = binomial(link = "logit",
                                    data = ))
```

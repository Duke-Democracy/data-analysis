---
title: "model-building-svyglm"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#load libraries
library(tidyverse)
library(cpsvote)
library(srvyr)
library(survey)
library(rstanarm)
library(bayesplot)
library(purrr)
library(tidycensus)
```

```{r}
#load data
data_20 <- read_csv("data/cps_csv_files/2020 cps.csv")
data_18 <- read_csv("data/cps_csv_files/2018 cps.csv")
data_16 <- read_csv("data/cps_csv_files/2016 cps.csv")
data_14 <- read_csv("data/cps_csv_files/2014 cps.csv")
data_12 <- read_csv("data/cps_csv_files/2012 cps.csv")
data_10 <- read_csv("data/cps_csv_files/2010 cps.csv")
data_total <- read_csv("data/cps_csv_files/master.csv")

vep_20 <- read_csv("data/2020 VEP.csv") |>
  filter(STATE != "United States") |>
  mutate(total_ballot = as.numeric(gsub("%", "", total_ballot))/100)
vep_18 <- read_csv("data/2018 VEP.csv")|>
  filter(STATE != "United States") |>
  mutate(total_ballot = as.numeric(gsub("%", "", total_ballot))/100)
vep_16 <- read_csv("data/2016 VEP.csv")|>
  filter(STATE != "United States") |>
  mutate(total_ballot = as.numeric(gsub("%", "", total_ballot))/100)
vep_14 <- read_csv("data/2014 VEP.csv")|>
  filter(STATE != "United States") |>
  mutate(total_ballot = as.numeric(gsub("%", "", total_ballot))/100)
vep_12 <- read_csv("data/2012 VEP.csv")|>
  filter(STATE != "United States") |>
  mutate(total_ballot = as.numeric(gsub("%", "", total_ballot))/100)
vep_10 <- read_csv("data/2010 VEP.csv")|>
  filter(STATE != "United States") |>
  mutate(total_ballot = as.numeric(gsub("%", "", total_ballot))/100)
```

```{r}
#clean data

#2010 DATA
data_10 <- data_10 |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = case_when(
    RACE == 100 ~ "White", 
    RACE == 200 ~ "Black", 
    RACE == 300 ~ "AmIn", 
    RACE == 700 ~ "Other",
    RACE %in% c(650, 651, 652, 809) ~ "AAPI", 
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
  SCHLCOLL = recode(SCHLCOLL, 
    "3" = "College", 
    "4" = "College",
    "5" = "Non-College",
    "1" = "HS", 
    "2" = "HS", 
    "0" = "NIU"),
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU")|>
    factor(levels = c("NIU", "No HS", "HS", "Some College", "Beyond Bachelors")),
  AGE = case_when(AGE < 30 ~ "18-29", 
                  AGE < 45 ~ "30-44",
                  AGE < 65 ~ "45-64",
                  .default = "65+"),
  VOTED = recode(VOTED,
                 "2" = "Yes",
                 "1" = "No",
                 .default = NULL)) |>
  mutate(VOTED = factor(VOTED, levels = c("Yes", "No"))) |>
  drop_na(VOTED) |>
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, SCHLCOLL, VOTED, VOSUPPWT)

#2012 DATA

data_12 <- data_12 |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = case_when(
    RACE == 100 ~ "White", 
    RACE == 200 ~ "Black", 
    RACE == 300 ~ "AmIn", 
    RACE == 700 ~ "Other",
    RACE %in% c(650, 651, 652, 809) ~ "AAPI", 
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
  SCHLCOLL = recode(SCHLCOLL, 
    "3" = "College", 
    "4" = "College",
    "5" = "Non-College",
    "1" = "HS", 
    "2" = "HS", 
    "0" = "NIU"),
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU") |>
    factor(levels = c("NIU", "No HS", "HS", "Some College", "Beyond Bachelors")),
  AGE = case_when(AGE < 30 ~ "18-29", 
                  AGE < 45 ~ "30-44",
                  AGE < 65 ~ "45-64",
                  .default = "65+"),
  VOTED = recode(VOTED,
                 "2" = "Yes",
                 "1" = "No",
                 .default = NULL)) |>
  mutate(VOTED = factor(VOTED, levels = c("Yes", "No"))) |>
  drop_na(VOTED) |>
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, SCHLCOLL, VOTED, VOSUPPWT)

#2014 DATA

data_14 <- data_14 |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = case_when(
    RACE == 100 ~ "White", 
    RACE == 200 ~ "Black", 
    RACE == 300 ~ "AmIn", 
    RACE == 700 ~ "Other",
    RACE %in% c(650, 651, 652, 809) ~ "AAPI", 
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
  SCHLCOLL = recode(SCHLCOLL, 
    "3" = "College", 
    "4" = "College",
    "5" = "Non-College",
    "1" = "HS", 
    "2" = "HS", 
    "0" = "NIU"),
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU") |>
    factor(levels = c("NIU", "No HS", "HS", "Some College", "Beyond Bachelors")),
  AGE = case_when(AGE < 30 ~ "18-29", 
                  AGE < 45 ~ "30-44",
                  AGE < 65 ~ "45-64",
                  .default = "65+"),
  VOTED = recode(VOTED,
                 "2" = "Yes",
                 "1" = "No",
                 .default = NULL)) |>
  mutate(VOTED = factor(VOTED, levels = c("Yes", "No"))) |>
  drop_na(VOTED) |>
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, SCHLCOLL, VOTED, VOSUPPWT)

#2016 DATA

data_16 <- data_16 |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = case_when(
    RACE == 100 ~ "White", 
    RACE == 200 ~ "Black", 
    RACE == 300 ~ "AmIn", 
    RACE == 700 ~ "Other",
    RACE %in% c(650, 651, 652, 809) ~ "AAPI", 
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
  SCHLCOLL = recode(SCHLCOLL, 
    "3" = "College", 
    "4" = "College",
    "5" = "Non-College",
    "1" = "HS", 
    "2" = "HS", 
    "0" = "NIU"),
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU") |>
    factor(levels = c("NIU", "No HS", "HS", "Some College", "Beyond Bachelors")),
  AGE = case_when(AGE < 30 ~ "18-29", 
                  AGE < 45 ~ "30-44",
                  AGE < 65 ~ "45-64",
                  .default = "65+"),
  VOTED = recode(VOTED,
                 "2" = "Yes",
                 "1" = "No",
                 .default = NULL)) |>
  mutate(VOTED = factor(VOTED, levels = c("Yes", "No"))) |>
  drop_na(VOTED) |>
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, SCHLCOLL, VOTED, VOSUPPWT)

#2018 DATA

data_18 <- data_18 |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = case_when(
    RACE == 100 ~ "White", 
    RACE == 200 ~ "Black", 
    RACE == 300 ~ "AmIn", 
    RACE == 700 ~ "Other",
    RACE %in% c(650, 651, 652, 809) ~ "AAPI", 
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
  SCHLCOLL = recode(SCHLCOLL, 
    "3" = "College", 
    "4" = "College",
    "5" = "Non-College",
    "1" = "HS", 
    "2" = "HS", 
    "0" = "NIU"),
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU") |>
    factor(levels = c("NIU", "No HS", "HS", "Some College", "Beyond Bachelors")),
  AGE = case_when(AGE < 30 ~ "18-29", 
                  AGE < 45 ~ "30-44",
                  AGE < 65 ~ "45-64",
                  .default = "65+"),
  VOTED = recode(VOTED,
                 "2" = "Yes",
                 "1" = "No",
                 .default = NULL)) |>
  mutate(VOTED = factor(VOTED, levels = c("Yes", "No"))) |>
  drop_na(VOTED) |>
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, SCHLCOLL, VOTED, VOSUPPWT)

#2020 DATA

data_20 <- data_20 |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = case_when(
    RACE == 100 ~ "White", 
    RACE == 200 ~ "Black", 
    RACE == 300 ~ "AmIn", 
    RACE == 700 ~ "Other",
    RACE %in% c(650, 651, 652, 809) ~ "AAPI", 
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
  SCHLCOLL = recode(SCHLCOLL, 
    "3" = "College", 
    "4" = "College",
    "5" = "Non-College",
    "1" = "HS", 
    "2" = "HS", 
    "0" = "NIU"),
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU") |>
    factor(levels = c("NIU", "No HS", "HS", "Some College", "Beyond Bachelors")),
  AGE = case_when(AGE < 30 ~ "18-29", 
                  AGE < 45 ~ "30-44",
                  AGE < 65 ~ "45-64",
                  .default = "65+"),
  VOTED = recode(VOTED,
                 "2" = "Yes",
                 "1" = "No",
                 .default = NULL)) |>
  mutate(VOTED = factor(VOTED, levels = c("Yes", "No")),
         EDUC = factor(EDUC, levels = c("No HS", "HS", "Some College", "Beyond Bachelors"))) |>
  drop_na(VOTED) |>
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, SCHLCOLL, VOTED, VOSUPPWT)

#MASTER DATA

data_total <- data_total |> mutate(
  REGION = recode(REGION, 
    "11" = "Northeast",
    "12" = "Northeast",
    "21" = "Midwest",
    "22" = "Midwest",
    "31" = "South", 
    "32" = "South", 
    "33" = "South", 
    "41" = "West",
    "42" = "South", 
    .default = "Other"), 
  SEX = recode(SEX,
    "1" = "Male", 
    "2" = "Female",
    .default = "NIU"),
  RACE = case_when(
    RACE == 100 ~ "White", 
    RACE == 200 ~ "Black", 
    RACE == 300 ~ "AmIn", 
    RACE == 700 ~ "Other",
    RACE %in% c(650, 651, 652, 809) ~ "AAPI", 
    .default = "Multi-racial"),
  HISPAN = recode(HISPAN,
    "000" = "Not Hispanic",            
    "901" =  "NIU", 
    "902" =  "NIU", 
    .default = "Hispanic"), 
  DIFFANY = recode(DIFFANY,
    "1" = "No", 
    "2" = "Yes",
    "0" = "NIU"), 
   EDUC = case_when(EDUC >= 999 ~ "Unknown", 
                                EDUC >= 120 ~ "Beyond Bachelors", 
                                EDUC >= 80 ~ "Some College", 
                                EDUC == 73 ~ "HS", 
                                EDUC >= 2 ~ "No HS", 
                                EDUC <= 1 ~ "NIU") |>
    factor(levels = c("NIU", "No HS", "HS", "Some College", "Beyond Bachelors")),
  AGE = case_when(AGE < 30 ~ "18-29", 
                  AGE < 45 ~ "30-44",
                  AGE < 65 ~ "45-64",
                  .default = "65+"),
  VOTED = recode(VOTED,
                 "2" = "Yes",
                 "1" = "No",
                 .default = NULL)) |>
  mutate(VOTED = factor(VOTED, levels = c("Yes", "No")),
         EDUC = factor(EDUC, levels = c("No HS", "HS", "Some College", "Beyond Bachelors"))) |>
  drop_na(VOTED) |>
  select(REGION, STATEFIP, AGE, SEX, RACE, HISPAN, EDUC, DIFFANY, VOTED, VOSUPPWT)

ids <- c(1,2,4,5,6,8,9,10,11,12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,44,45,46,47,48,49,50,51,53,54,55,56)
states <- c("Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming")

states_list <- list("Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "District of Columbia", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming")

states_df <- data.frame(ids, as.factor(states))

names(states_df) <- c('STATEFIP', 'STATE')

data_10 <- merge(data_10, states_df, by="STATEFIP", all = FALSE)
data_12 <- merge(data_12, states_df, by="STATEFIP", all = FALSE)
data_14 <- merge(data_14, states_df, by="STATEFIP", all = FALSE)
data_16 <- merge(data_16, states_df, by="STATEFIP", all = FALSE)
data_18 <- merge(data_18, states_df, by="STATEFIP", all = FALSE)
data_20 <- merge(data_20, states_df, by="STATEFIP", all = FALSE)
data_total <- merge(data_total, states_df, by="STATEFIP", all = FALSE)
```

```{r}
#create hur and achen weights

#2010 data
#2012 data
#2014 data
#2016 data
#2018 data
data_18_weighted <- data_18 |>
  as_survey_design(weights = VOSUPPWT)

turnout_18 <- data_18_weighted |>
  group_by(STATE) |>
  summarize(turnout = survey_mean(VOTED == "Yes", na.rm = TRUE))

turnout_weights_18 <- turnout_18 |>
  left_join(vep_18, by = "STATE") |>
  mutate(weight_nonvoter_num = 1 - total_ballot,
         weight_nonvoter_denom = 1 - turnout,
         weight_voter = total_ballot/turnout,
         weight_nonvoter = weight_nonvoter_num/weight_nonvoter_denom) |>
  select(STATE, weight_nonvoter, weight_voter)

augmented_data_18 <- data_18 |>
  left_join(turnout_weights_18, by = "STATE") |>
  mutate(ADJ_VOSUPPWT = case_when(VOTED == "Yes" ~ VOSUPPWT * weight_voter,
                                  VOTED == "No" ~ VOSUPPWT * weight_nonvoter))

hurachen_data_18 <- augmented_data_18 |>
  as_survey_design(weights = ADJ_VOSUPPWT)

hurachen_turnout_18 <- hurachen_data_18 |>
  group_by(STATE) |>
  summarize(turnout = survey_mean(VOTED == "Yes", na.rm = TRUE))

```

```{r}
#look for interactions

#state, age
data_total |>
  group_by(AGE, STATE) |>
  summarize(age_diffany_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = STATE, y = age_diffany_turnout, color = AGE)) +
  geom_point()

#state, ethnicity
data_total |>
  group_by(HISPAN, STATE) |>
  summarize(age_diffany_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = STATE, y = age_diffany_turnout, color = HISPAN)) +
  geom_point()

#state, disability
data_total |>
  group_by(DIFFANY, STATE) |>
  summarize(age_diffany_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = STATE, y = age_diffany_turnout, color = DIFFANY)) +
  geom_point()
#state, educ
data_total |>
  group_by(EDUC, STATE) |>
  summarize(age_diffany_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = STATE, y = age_diffany_turnout, color = EDUC)) +
  geom_point()
#state, race
data_total |>
  group_by(RACE, STATE) |>
  summarize(age_diffany_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = STATE, y = age_diffany_turnout, color = RACE)) +
  geom_point()

#no interaction between age, disability
data_total |>
  group_by(AGE, DIFFANY) |>
  summarize(age_diffany_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = AGE, y = age_diffany_turnout, color = DIFFANY)) +
  geom_point() +
  geom_path(aes(group = interaction(AGE, DIFFANY)))

# no interaction between age, ethnicity
data_total |>
  group_by(AGE, HISPAN) |>
  summarize(age_hispan_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = AGE, y = age_hispan_turnout, color = HISPAN)) +
  geom_point()

# none age, education
data_total |>
  group_by(AGE, EDUC) |>
  summarize(age_educ_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = AGE, y = age_educ_turnout, color = EDUC)) +
  geom_point()

# age, race FOUND INTERACTION
data_total |>
  group_by(AGE, RACE) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = AGE, y = age_race_turnout, color = RACE)) +
  geom_point()

# ethnicity, disability
data_total |>
  group_by(HISPAN, DIFFANY) |>
  summarize(age_diffany_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = HISPAN, y = age_diffany_turnout, color = DIFFANY)) +
  geom_point() +
  geom_path(aes(group = interaction(HISPAN, DIFFANY)))

# ethnicity, education
data_total |>
  group_by(HISPAN, EDUC) |>
  summarize(age_educ_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = HISPAN, y = age_educ_turnout, color = EDUC)) +
  geom_point()

# ethnicity, race FOUND INTERACTION
data_total |>
  group_by(HISPAN, RACE) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = HISPAN, y = age_race_turnout, color = RACE)) +
  geom_point()

# race, disability
data_total |>
  group_by(RACE, DIFFANY) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = DIFFANY, y = age_race_turnout, color = RACE)) +
  geom_point()

# race, education IT EXISTS!
data_total |>
  group_by(RACE, EDUC) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = EDUC, y = age_race_turnout, color = RACE)) +
  geom_point()

# disability, education
data_total |>
  group_by(DIFFANY, EDUC) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = EDUC, y = age_race_turnout, color = DIFFANY)) +
  geom_point()

# age, ethnicity, race YES
data_total |>
  group_by(DIFFANY, AGE, RACE) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = AGE, y = age_race_turnout, color = RACE)) +
  geom_point() +
  facet_wrap(vars(DIFFANY))

# race, education, ethnicity YES
data_total |>
  group_by(EDUC, HISPAN, RACE) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = EDUC, y = age_race_turnout, color = RACE)) +
  geom_point() +
  facet_wrap(vars(HISPAN))

# race, age, disability NO
data_total |>
  group_by(AGE, DIFFANY, RACE) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = AGE, y = age_race_turnout, color = RACE)) +
  geom_point() +
  facet_wrap(vars(DIFFANY))

#race, ethnicity, disability YES
data_total |>
  group_by(DIFFANY, HISPAN, RACE) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = DIFFANY, y = age_race_turnout, color = RACE)) +
  geom_point() +
  facet_wrap(vars(HISPAN))

#educ, ethnicity, disability YES
data_total |>
  group_by(DIFFANY, HISPAN, EDUC) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = EDUC, y = age_race_turnout, color = DIFFANY)) +
  geom_point() +
  facet_wrap(vars(HISPAN))

#educ, race, age

data_total |>
  group_by(AGE, RACE, EDUC) |>
  summarize(age_race_turnout = sum(VOTED == "Yes")/n()) |>
  ggplot(aes(x = EDUC, y = age_race_turnout, color = AGE)) +
  geom_point() +
  facet_wrap(vars(RACE))
```

```{r}
#MODELLING
turnout_mod_2010 <- svyglm(formula = VOTED ~ STATE + RACE + HISPAN + DIFFANY + AGE + EDUC + STATE*RACE + RACE*EDUC + RACE*HISPAN + AGE*RACE, design = hurachen_data_18, family = quasibinomial)

summary(turnout_mod_2010)

turnout_mod_2012 <- svyglm(formula = VOTED ~ STATE + RACE + HISPAN + DIFFANY + AGE + EDUC + STATE*RACE + RACE*EDUC + RACE*HISPAN + AGE*RACE, design = hurachen_data_18, family = quasibinomial)

summary(turnout_mod_2012)

turnout_mod_2014 <- svyglm(formula = VOTED ~ STATE + RACE + HISPAN + DIFFANY + AGE + EDUC + STATE*RACE + RACE*EDUC + RACE*HISPAN + AGE*RACE, design = hurachen_data_18, family = quasibinomial)

summary(turnout_mod_2014)

turnout_mod_2016 <- svyglm(formula = VOTED ~ STATE + RACE + HISPAN + DIFFANY + AGE + EDUC + STATE*RACE + RACE*EDUC + RACE*HISPAN + AGE*RACE, design = hurachen_data_18, family = quasibinomial)

summary(turnout_mod_2016)

turnout_mod_2018 <- svyglm(formula = VOTED ~ STATE + RACE + HISPAN + DIFFANY + AGE + EDUC + STATE*RACE + RACE*EDUC + RACE*HISPAN + AGE*RACE, design = hurachen_data_18, family = quasibinomial)

summary(turnout_mod_2018)

turnout_mod_2020 <- svyglm(formula = VOTED ~ STATE + RACE + HISPAN + DIFFANY + AGE + EDUC + STATE*RACE + RACE*EDUC + RACE*HISPAN + AGE*RACE, design = hurachen_data_18, family = quasibinomial)

summary(turnout_mod_2020)
```

```{r}
#RACE COEFFS
#for state1 through state 51, predict(turnout_mod_thatyear, )
```

```{r}
#ETHNICITY COEFFS
```

```{r}
#EDUC COEFFS
```
